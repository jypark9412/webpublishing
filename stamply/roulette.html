<!DOCTYPE html>
<html lang="ko">
	<%-include('inc/header.html')%>
	<%-include('inc/widget.html')%>
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script> 
<body>
  <div class="roulette-container offset-mb-xl container-sm">
    <header class="g-3">
      <div class="header-wrap d-grid a-center justify-content-between">
        <a class="link-back" href="" title="뒤로가기"><i class="icon-arrow-left"></i><span class="text-indent">뒤로가기</span></a>
        <!-- [D] NP-2544 블루닷 : new -->
        <a class="btn-transparent btn-group me-3 new" href="roulette_result.html" title="당첨 내역">
          당첨 내역
        </a>
      </div>
    </header>
    <div class="roulette-wrap">
      <div class="title">
        <h3 class="text-indent">꽝 없는 행운의 룰렛</h3>
        <p class="text-indent">지금 바로 도전해 보세요!</p>
      </div>
      
      <!-- NP-2261 룰렛 도전 기회 위치 변경 -->
      <div class="roulette-count">
        <p class="text">도전기회</p>
        <strong class="num">000</strong>
      </div>
      <div class="roulette-area">
        <div class="roulette-box">
          <!-- 룰렛 게임 영역 -->
          <button type="button" class="btn-start">
            <span class="text-indent">룰렛 도전</span>
          </button>
          <div class="roulette">
            <canvas width="356" height="356"></canvas>
            <ul>
              <li class="item">
                <img src="/static/images/roulette/gift_starbucksT2.png" alt="경품 이미지">
              </li>
              <li class="item">
                <img src="/static/images/roulette/gift_mc.png" alt="경품 이미지">
              </li>
              <li class="item">
                <img src="/static/images/roulette/gift_starbucksT.png" alt="경품 이미지">
              </li>
              <li class="item">
                <img src="/static/images/roulette/gift_jaws.png" alt="경품 이미지">
              </li>
              <li class="item">
                <img src="/static/images/roulette/gift_back.png" alt="경품 이미지">
              </li>
              <li class="item">
                <img src="/static/images/roulette/gift_ediya.png" alt="경품 이미지">
              </li>
            </ul>
          </div>
        </div>
      </div>
      <!-- 룰렛 띠 배너 -->
      <div class="roulette-banner"></div>
    </div>
    
    <!-- 룰렛 정보 리스트 -->
    <div class="list-guide">
    <ul class="detail">
      <li class="text-muted">스탬프가 10개 적립되면 룰렛에 1회 도전할 수 있습니다.</li>
      <li class="text-muted">당첨된 경품은 운영자 확인 후 최종 지급되며, 자세한 사항은 당첨내역 보기 &#62; 안내 페이지를 확인해 주세요.</li>
      <li class="text-muted">룰렛 경품은 사전 고지 없이 변경될 수 있습니다.</li>
    </ul>
  </div>
    <!-- //룰렛 영역 -->

    <!-- 휴대전화 번호 확인 팝업 -->
    <div class="modal fade" id="resultModal1" tabindex="-1" data-bs-backdrop="static" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered flex-column j-center">
        <div class="modal-content">
          <div class="bg-modal">
            <div class="modal-header">
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close">
                <span class="text-indent">닫기</span>
              </button>
            </div>
            <div class="modal-body text-center pb-6 px-4">
              <div class="d-flex flex-column a-center">
                <p class="icon"></p>
                <div class="title title-lg mt-3">확인해 주세요</div>
                <div class="text">경품 당첨 시 아래<br> 휴대전화 번호로 발송됩니다.</div>
                <div class="number-area">
                  <p>000-0000-0000</p>
                  <a href="" target="_blank" class="btn btn-change">변경</a>
                </div>
                <p class="notice mt-2">잘못된 휴대전화 번호로 기프티콘이 발송된 경우 재발송이 불가합니다.</p>
              </div>
            </div>
          </div>
          <button class="btn btn-primary rounded-0" data-bs-dismiss="modal" onclick="$('#appReviewModal').modal('show');">확인</button> <!--[D] NP-2540 rounded-0 추가-->
        </div>
      </div>
    </div>

    <!-- 당첨 확인 팝업 -->
    <div class="modal fade" id="resultModal2" tabindex="-1" data-bs-backdrop="static" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered flex-column j-center">
        <div class="modal-content">
          <div class="bg-modal">
            <div class="modal-body text-center py-6 px-4">
              <div class="d-flex flex-column a-center">
                <p class="icon"></p>
        
                <div class="title mt-3">

                  <div class="giveaway">
                    <p class="text-gray">브랜드명</p>
                    상품명
                  </div>

                  당첨을 축하합니다
                </div>
                <div class="text">경품은 영업일 기준<br><span class="color-primary">3일 내 발송</span>됩니다.</div>
              </div>
            </div>
          </div>
          <button class="btn btn-primary rounded-0" data-bs-dismiss="modal">확인</button> <!--[D] NP-2540 rounded-0 추가-->
        </div>
      </div>
    </div>
  </div>

  <!-- 블랙리스트 처리 안내 팝업 -->
  <div class="modal fade" id="blacklistModal" tabindex="-1" data-bs-backdrop="static" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered flex-column j-center">
      <div class="modal-content">
        <div class="bg-modal">
          <div class="modal-header">
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close">
              <span class="text-indent">닫기</span>
            </button>
          </div>
          <div class="modal-body text-center py-6 px-4">
            <div class="d-flex flex-column a-center">
              <p class="icon"></p>
              <div class="title mt-3">서비스 이용이 제한되었어요.</div>
              <div class="section">
                스탬프 사용 후<br> 
                <span class="color-primary">구매 취소 금액이 일정 수준을 초과</span>하여<br>
                이용 약관에 따라 처리되었습니다.
              </div>
              <p class="notice mb-8">관련하여 문의사항이 있으실 경우,<br>
                마이페이지 <a href="" class="text-decoration-underline">문의하기</a>를 이용해 주세요.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 앱 리뷰 작성 팝업 -->
  <div class="modal fade stamply" id="appReviewModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered flex-column j-center">
      <div class="modal-content">
        <div class="bg-modal">
          <div class="modal-body text-center py-6 px-4">
            <div class="d-flex flex-column a-center">
              <p class="icon"></p>
              <div class="title mt-3">스탬플리 앱 어떠신가요?</div>
              <p class="body-md text-gray-200">별점 평가하고 의견을 남겨주세요.<br>저희에게 큰 도움과 힘이 됩니다 🙂</p>
            </div>
          </div>
        </div>
        <button class="btn btn-primary fw-600 rounded-0" data-bs-dismiss="modal">앱 평가하기</button>
      </div>
      <a href="" target="_blank" class="btn-text-close text-center underline" data-bs-dismiss="modal" aria-label="Close" onclick="iniGame()">다음에 할게요</a>
    </div>
  </div>
<<<<<<< HEAD
  <!-- //앱 리뷰 작성 팝업 -->
=======
>>>>>>> 326c064c09e6a4dab7381cff58942ef3d578e54c

</body>
<script>
//룰렛 이벤트 JS
$(document).ready(function() {
  //NP-2261 룰렛 아이템 배치
  const rouletteRadius = 178; // 반지름
  const itemDistance = 80; // 아이템과 원 중심 간의 거리
  const numItems = 6;
  const angleStep = 360 / numItems;
  const items = document.querySelectorAll('.item');
  
  items.forEach((item, index) => {
    const angle = index * angleStep;
    const radians = (angle + 90) * (Math.PI / 180);
    const x = (rouletteRadius - itemDistance) * Math.cos(radians);
    const y = (rouletteRadius - itemDistance) * Math.sin(radians);
    item.style.left = `calc(50% + ${x}px)`;
    item.style.top = `calc(50% - ${y}px)`;
    item.style.transform = `translate(-50%, -50%) rotate(${-angle}deg)`;
  });

  var gift;
  var rotationPos = new Array(60,120,180,240,300,360);
  iniGame = function(num){
    gift = num;
    TweenLite.killTweensOf($(".roulette")); //모든 모션 리셋
    TweenLite.to($(".roulette"), 0, {css:{rotation:rotationPos[gift]}}); //룰렛 회전 시작
    TweenLite.from($(".roulette"),5, {css:{rotation:-3000}, onComplete:endGame, ease:Sine.easeOut});
    TweenLite.set($(".btn-start").addClass('none'), {disabled:true}); // 버튼 비활성화
  }

  function endGame(){
    setTimeout(openPopup, 100);
    TweenLite.set($(".btn-start").removeClass('none'), {disabled:false}); // 버튼 활성화
    TweenLite.from($(".btn-start").removeClass('none'), {delay: 500});
  }

  function openPopup() {
  //당첨 내역 확인 팝업
   $("#resultModal2").modal("show");
   //NP-2261 폭죽 모션
     document.querySelector("#resultModal2 .modal-dialog").insertAdjacentHTML('afterbegin', `
     <div class="position-absolute z-3"><lottie-player src="https://lottie.host/6e2beb64-9e89-42c0-9654-af4f5baa86a4/EX0FAIi45q.json" background="transparent" speed="1" style="width: 100%; height: 100%;" loop autoplay></lottie-player></div>
  `);
  }

  //iOS 대응
  const appHeight = () => {
  const doc = document.documentElement
    doc.style.setProperty('--app-height', $(window.innerHeight)+px);
  }
  window.addEventListener('resize', appHeight);
  appHeight();
});


$(function() {
  var clicked = 0;
  //시작 버튼 누를 때
  $(".btn-start").on("click",function(){
    $("#resultModal1").modal("show"); //휴대번호 확인 팝업
    //블랙리스트 처리 안내 팝업
    //$("#blacklistModal").modal("show"); 
    TweenLite.to($(".roulette"), 0, {css:{rotation:rotationPos[0]}}); // 팝업 노출 시 룰렛 이벤트 멈춤
    if( clicked <= 0 ){
      iniGame(Math.floor(Math.random() * 6));
    } else if( clicked >= 1) {
      event.preventDefault();
    }
    clicked ++
  });
})

//NP-2261 띠배너 효과
const rouletteWrap = document.querySelector('.roulette-banner');
let backgroundPositionX = 10; 
function increaseBackgroundPositionX() {
  backgroundPositionX -= 1; 
  rouletteWrap.style.setProperty('background-position-x', `${backgroundPositionX}px`);
}
setInterval(increaseBackgroundPositionX, 24); 
</script>
</html>